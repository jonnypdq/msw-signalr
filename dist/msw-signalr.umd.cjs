(function(l,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("msw")):typeof define=="function"&&define.amd?define(["exports","msw"],r):(l=typeof globalThis<"u"?globalThis:l||self,r(l["msw-signalr"]={},l.msw))})(this,function(l,r){"use strict";function H(e){return{all:e=e||new Map,on:function(t,n){var a=e.get(t);a?a.push(n):e.set(t,[n])},off:function(t,n){var a=e.get(t);a&&(n?a.splice(a.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var a=e.get(t);a&&a.slice().map(function(p){p(n)}),(a=e.get("*"))&&a.slice().map(function(p){p(t,n)})}}}const I=15e3,v=1,N=3,h=6,T=7,f=400,R=404;function O(e){const t={connectionId:crypto.randomUUID(),availableTransports:[{transport:"ServerSentEvents",transferFormats:["Text"]}]};return e===0?{...t,negotiateVersion:0}:{...t,negotiateVersion:1,connectionToken:crypto.randomUUID()}}const k=(e=I)=>{let t;return new TransformStream({start(n){n.enqueue({}),t=window.setInterval(()=>{n.enqueue({type:h})},e)},flush(){window.clearInterval(t)}})},x=()=>new TransformStream({transform(e,t){t.enqueue(JSON.stringify(e)+"")}}),L=()=>new TransformStream({transform(e,t){t.enqueue("data: "+e+`

`)}}),m=async(e,t)=>{const n=e.getWriter();await n.ready,await n.write(t),n.releaseLock()};function U(e,t={}){const n=new Map,a=H(),p=c=>{const i=new URL(c.url).searchParams.get("id");return i!==null?n.get(i):void 0};return{connections:n,server:a,broadcast(c,...o){n.forEach(i=>{i.send(c,...o).catch(console.error)})},handlers:[r.http.post(`${e}/negotiate`,async({request:c})=>{var y;await((y=t.delay)==null?void 0:y.call(t));const i=new URL(c.url).searchParams.get("negotiateVersion");if(i===null)return new r.HttpResponse(null,{status:f});const u=Number.parseInt(i);if(u!==0&&u!==1)return new r.HttpResponse(null,{status:f});const s=O(u),d=s.negotiateVersion===0?s.connectionId:s.connectionToken;return n.set(d,{key:d,id:s.connectionId,stream:new TransformStream,async send(g,...w){await m(this.stream.writable,{type:v,target:g,arguments:w})},async complete(g,w,V){await m(this.stream.writable,{type:N,invocationId:g,result:w,error:V})},async close(){await m(this.stream.writable,{type:T})}}),r.HttpResponse.json(s)}),r.http.get(e,async({request:c})=>{var i;await((i=t.delay)==null?void 0:i.call(t));const o=p(c);return o?(o.stream=k(t.keepAliveInterval),new r.HttpResponse(o.stream.readable.pipeThrough(x()).pipeThrough(L()).pipeThrough(new TextEncoderStream),{headers:{"Content-Type":"text/event-stream"}})):new r.HttpResponse(null,{status:R})}),r.http.post(e,async({request:c})=>{var d;await((d=t.delay)==null?void 0:d.call(t));const o=p(c);if(!o)return new r.HttpResponse(null,{status:R});const i=(await c.text()).replace(/\x1e$/,"");let u,s={};try{if(s=JSON.parse(i),S(s)||E(s))u=s;else return new r.HttpResponse(null,{status:f})}catch{return new r.HttpResponse(null,{status:f})}if(S(u)&&u.protocol.toUpperCase()==="JSON"&&[0,1].includes(u.version))return new r.HttpResponse;if(E(u)){if(s.type===v){let y=s.invocationId;return a.emit("invoke",{connection:o,target:s.target,id:y,parameters:s.arguments}),new r.HttpResponse}if(s.type===h)return new r.HttpResponse;if(s.type===T)return await o.stream.writable.close(),n.delete(o.key),new r.HttpResponse}return new r.HttpResponse(null,{status:f})})]}}const S=e=>e!==null&&typeof e=="object"&&"protocol"in e&&typeof e.protocol=="string"&&"version"in e&&typeof e.version=="number",E=e=>e!==null&&typeof e=="object"&&"type"in e&&typeof e.type=="number";l.signalRHub=U,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
